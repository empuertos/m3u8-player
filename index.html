<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Player JSON (Auto-Paging)</title>
<style>
  body {background:#000;color:#fff;font-family:Arial,sans-serif;text-align:center;}
  h1 {margin-top:20px;color:#00ff9d;}
  input {width:80%;padding:12px;margin:15px 0;font-size:18px;border-radius:8px;border:none;outline:none;}
  #list {max-height:400px;overflow-y:auto;width:80%;margin:0 auto;text-align:left;}
  #list div {padding:10px;cursor:pointer;background:#111;margin-bottom:5px;border-radius:6px;transition:0.2s;}
  #list div:hover {background:#222;}
  iframe {width:80%;height:480px;border:none;margin-top:20px;border-radius:10px;}
</style>
</head>
<body>
  <h1>ðŸŽ¬ Movie Player JSON</h1>
  <input type="text" id="search" placeholder="Search movie title...">
  <div id="list"></div>
  <div id="player"></div>

<script>
const totalFiles = 4; // number of JSON files
let cache = {};       // cache loaded files
let allMovies = [];   // search results

// Fetch a JSON file if not cached
async function getMoviesFile(i){
  if(cache[i]) return cache[i];
  try {
    const res = await fetch(`./movies/movies${i}.json`);
    const data = await res.json();
    cache[i] = data;
    return data;
  } catch {
    console.warn(`movies${i}.json missing`);
    cache[i] = [];
    return [];
  }
}

// Search across files dynamically
async function searchMovies(keyword){
  const key = keyword.toLowerCase();
  allMovies = [];
  document.getElementById('list').innerHTML = '<div>Searching...</div>';

  for(let i=1;i<=totalFiles;i++){
    const file = await getMoviesFile(i);
    const matches = file.filter(m=>m.title.toLowerCase().includes(key));
    if(matches.length>0){
      allMovies = allMovies.concat(matches);
      // show partial results as we find them
      updateList(allMovies.slice(0,30));
    }
  }

  if(allMovies.length===0)
    document.getElementById('list').innerHTML='<div>No results found.</div>';
}

// Display search results
function updateList(arr){
  const listDiv=document.getElementById('list');
  listDiv.innerHTML = arr.slice(0,30).map(m =>
    `<div onclick="playMovie('${m.src.replace(/'/g,"\\'")}')">${m.title}</div>`
  ).join('');
}

// Play selected movie
function playMovie(src){
  document.getElementById('player').innerHTML=
    `<iframe src="${src}" allowfullscreen loading="lazy"></iframe>`;
}

// Input event
let timer;
document.getElementById('search').addEventListener('input', e=>{
  clearTimeout(timer);
  const val=e.target.value.trim();
  if(val.length<2){document.getElementById('list').innerHTML='';return;}
  timer=setTimeout(()=>searchMovies(val),300);
});
</script>
</body>
</html>
